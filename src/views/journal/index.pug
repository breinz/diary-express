extends ../layout/layout


mixin line()
    tr
        -d=0
        while d++ < 7
            if first>cell++ || last<n
                td.no-hover &nbsp;
            else
                td(data-link="/" data-show-hover=`cell${n}-content` style="width:5%;border:1px solid #DEE2E6")
                    +cell(n++)

mixin cell(day)
    div(style="min-height:80px")
        a.btn.text-success.btn-sm(href="/journal/new" style="float:right" title=t("journal.button.new") class=`cell${day}-content`)
            i.fa.fa-plus
        b=day
        br
        for expense in journalData.expenses
            if expense.date.getDate() == day
                .text-danger
                    i.fa.fa-fw.fa-euro-sign
                    small
                        b=expense.amount.toFixed(2)
        for people in journalData.people
            if people.date.getDate() == day
                .text-success
                    i.fa.fa-fw.fa-user
                    small
                        b=people.firstName[0]

        if Math.random()>.9
            .text-primary
                i.fa.fa-fw.fa-sticky-note
                small
                    b=Math.round(Math.random()*5+1)

block content

    -d=new Date()
    -month = month || d.getMonth()+1
    -month = parseInt(month)-1
    -year = year || d.getFullYear()
    -year = parseInt(year)

    -first = new Date(year, month) // First day of month
    -first.setDate(1)
    -first = (first.getDay()||7)-1

    -last = new Date(year, month) // last day of month
    -last.setDate(1)
    -last.setMonth(last.getMonth()+1)
    -last.setDate(last.getDate()-1)
    -last = last.getDate()
    
    -n = 1 // cursor day
    -cell = 0 // cursor cell

    .container
        .row
            .col
                .h1-actions
                    .btn-group
                        a.btn.btn-sm.btn-outline-secondary(href=`/journal/${year}-${month}`)
                            i.fa.fa-angle-left
                            |&nbsp;
                            =t(`month.${month==0?11:month-1}.long`)+(month-1<=0?" "+(year-1):"")
                        a.btn.btn-sm.btn-outline-secondary(href=`/journal/${year}`)=year
                        a.btn.btn-sm.btn-outline-secondary(href=`/journal/${year}-${month+2}`) 
                            =t(`month.${month+1>=12?0:month+1}.long`)+(month+1>=12?" "+(year+1):"")
                            |&nbsp;
                            i.fa.fa-angle-right
                    |&nbsp;
                    +new_btn("/journal/new", t("journal.button.new"))
                h1=t(`month.${month}.long`)
                .alert.alert-hollow
                    table.table.table-hover-cells
                        thead
                            tr
                                th(style="width:5%")=t("day.0.short")
                                th(style="width:5%")=t("day.1.short")
                                th(style="width:5%")=t("day.2.short")
                                th(style="width:5%")=t("day.3.short")
                                th(style="width:5%")=t("day.4.short")
                                th(style="width:5%")=t("day.5.short")
                                th(style="width:5%")=t("day.6.short")
                        -l = 0
                        while l < Math.ceil((first+last)/7)
                            +line()
                            -l++
                    